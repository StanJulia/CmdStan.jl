<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Walkthrough · CmdStan.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">CmdStan.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../INTRO/">Introduction</a></li><li><a class="tocitem" href="../INSTALLATION/">Installation</a></li><li class="is-active"><a class="tocitem" href>Walkthrough</a><ul class="internal"><li><a class="tocitem" href="#Bernoulli-example"><span>Bernoulli example</span></a></li><li><a class="tocitem" href="#Output-format-options"><span>Output format options</span></a></li><li><a class="tocitem" href="#Running-a-CmdStan-script,-some-details"><span>Running a CmdStan script, some details</span></a></li></ul></li><li><a class="tocitem" href="../VERSIONS/">Versions</a></li><li><a class="tocitem" href="../">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Walkthrough</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Walkthrough</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/StanJulia/CmdStan.jl/blob/master/docs/src/WALKTHROUGH.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="A-walk-through-example"><a class="docs-heading-anchor" href="#A-walk-through-example">A walk-through example</a><a id="A-walk-through-example-1"></a><a class="docs-heading-anchor-permalink" href="#A-walk-through-example" title="Permalink"></a></h1><h2 id="Bernoulli-example"><a class="docs-heading-anchor" href="#Bernoulli-example">Bernoulli example</a><a id="Bernoulli-example-1"></a><a class="docs-heading-anchor-permalink" href="#Bernoulli-example" title="Permalink"></a></h2><p>Make CmdStan.jl available:</p><pre><code class="language-none">using CmdStan</code></pre><p>Define a variable, e.g. &#39;bernoullistanmodel&#39;, to hold the Stan model definition:</p><pre><code class="language-none">bernoullistanmodel = &quot;
data { 
  int&lt;lower=0&gt; N; 
  int&lt;lower=0,upper=1&gt; y[N];
} 
parameters {
  real&lt;lower=0,upper=1&gt; theta;
} 
model {
  theta ~ beta(1,1);
    y ~ bernoulli(theta);
}
&quot;</code></pre><p>Create a Stanmodel object by giving the model a name and pass in the Stan model:</p><pre><code class="language-none">stanmodel = Stanmodel(name=&quot;bernoulli&quot;, model=bernoullistanmodel);</code></pre><p>This creates a default model for sampling. A subsequent call to stan() will return an array of samples.</p><p>Other arguments to Stanmodel() can be found in <a href="../#CmdStan.Stanmodel"><code>Stanmodel</code></a></p><p>The observed input data is defined below.</p><pre><code class="language-none">bernoullidata = Dict(&quot;N&quot; =&gt; 10, &quot;y&quot; =&gt; [0, 1, 0, 1, 0, 0, 0, 0, 0, 1])</code></pre><p>Each chain will use this data. If needed, an Array{Dict} can be defined with the same number of entries as the number of chains. This is also true for the optional <code>init</code> argument to stan(). Use these features with care, particularly providing different data as the chains are supposed to be from identical observed data.</p><p>Run the simulation by calling stan(), passing in the data and the intended working directory. </p><pre><code class="language-none">ProjDir = @__DIR__
rc, chns, cnames = stan(stanmodel, bernoullidata, ProjDir, CmdStanDir=CMDSTAN_HOME)</code></pre><p>More documentation on stan() can be found in <a href="../#CmdStan.stan"><code>stan</code></a></p><p>If the return code rc indicated success (rc == 0), cmdstan execution completed succesfully.</p><p>Next possible steps can be:</p><pre><code class="language-none">sdf = read_summary(stanmodel)</code></pre><p>The first time (or when updates to the model have been made) stan() will compile the model and create the executable. </p><p>On Windows, the CmdStanDir argument appears needed (this is still being investigated). On OSX/Unix CmdStanDir is obtained from an environment variable (see the Requirements section).</p><p>By default stan() will run 4 chains and optionally display a combined summary. Some other CmdStan methods, e.g. optimize, return a dictionary.</p><p>If <code>summary = true</code>, the default, the stan summary is also written to a .csv file and can be read in using:</p><pre><code class="language-none">csd = read_summary(stanmodel)
csd[:theta, :mean] # Select mean as computed by the stansummary binary.</code></pre><p>Stanmodel has an optional argument <code>printsummary=false</code> to have cmdstan create the summary .csv file but not display the stansummary.</p><h2 id="Output-format-options"><a class="docs-heading-anchor" href="#Output-format-options">Output format options</a><a id="Output-format-options-1"></a><a class="docs-heading-anchor-permalink" href="#Output-format-options" title="Permalink"></a></h2><p>CmdStan.jl supports 3 output formats: </p><ol><li><p>A 3 dimensional array (&quot;a3d&quot;) where the first index refers to samples, the 2nd index to parameters and the 3rd index to chains.</p></li><li><p>A MCMCChains.Chains object, see the examples in subdirectory examples_mcmcchains.</p></li><li><p>A DataFrames object. </p></li></ol><p>The default output format is :array. </p><p>To specify options 2 and 3 use:</p><pre><code class="language-none">stammodel= Stanmodel(..., output_format=:mcmcchains, ...)</code></pre><p>or</p><pre><code class="language-none">stanmodel = Stanmodel(..., output_format=:dataframes, ...)</code></pre><p>when creating the Stanmodel.</p><p>It is very important that in order to use option 2 the package MCMCChains.jl needs to be installed and loaded in your script, e.g. see the <code>bernoulli.jl</code> example in the <code>examples_mcmcchains</code> directory.</p><h2 id="Running-a-CmdStan-script,-some-details"><a class="docs-heading-anchor" href="#Running-a-CmdStan-script,-some-details">Running a CmdStan script, some details</a><a id="Running-a-CmdStan-script,-some-details-1"></a><a class="docs-heading-anchor-permalink" href="#Running-a-CmdStan-script,-some-details" title="Permalink"></a></h2><p>CmdStan.jl really only consists of 2 functions, Stanmodel() and stan().</p><h3 id="[Stanmodel](@ref)"><a class="docs-heading-anchor" href="#[Stanmodel](@ref)"><a href="../#CmdStan.Stanmodel"><code>Stanmodel</code></a></a><a id="[Stanmodel](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#[Stanmodel](@ref)" title="Permalink"></a></h3><p>Stanmodel() is used to define the basic attributes for a model:</p><pre><code class="language-none">monitor = [&quot;theta&quot;, &quot;lp__&quot;, &quot;accept_stat__&quot;]
stanmodel = Stanmodel(name=&quot;bernoulli&quot;, model=bernoullistanmodel,
  monitors=monitor);
stanmodel</code></pre><p>Above script, in the Julia REPL, shows all parameters in the model, in this case (by default) a sample model.</p><p>Compared to the call to Stanmodel() above, the keyword argument monitors has been added. This means that after the simulation is complete, only the monitored variables will be read in from the .csv file produced by Stan. This can be useful if many, e.g. 100s, nodes are being observed.</p><p>If the requested result is an MCMCChains.Chains object, another option is available by using <code>set_section(chain, section_map_dict)</code>, e.g. see the example in <code>examples_mcmcchains/Dyes/dyes.jl</code>.</p><p>If the samples are stored in a vector of DataFrames, the usual DataFrames selection options are available.</p><p>Below an example of updating default model values when creating a model: </p><pre><code class="language-none">stanmodel2 = Stanmodel(Sample(adapt=CmdStan.Adapt(delta=0.9)), name=&quot;bernoulli2&quot;, nchains=6)</code></pre><p>The format is slightly different from cmdstan, but the parameters are as described in the cmdstan Interface User&#39;s Guide. This is also the case for the Stanmodel() optional arguments random, init and output (refresh only).</p><p>In the REPL, the stanmodel2 can be shown by:</p><pre><code class="language-none">stanmodel2</code></pre><p>After the Stanmodel object has been created fields can be updated, e.g.</p><pre><code class="language-none">stanmodel2.method.adapt.delta=0.85</code></pre><h3 id="[stan](@ref)"><a class="docs-heading-anchor" href="#[stan](@ref)"><a href="../#CmdStan.stan"><code>stan</code></a></a><a id="[stan](@ref)-1"></a><a class="docs-heading-anchor-permalink" href="#[stan](@ref)" title="Permalink"></a></h3><p>After a Stanmodel has been created, the workhorse function stan() is called to run the simulation. Note that some fields in the Stanmodel are updated by stan().</p><p>After the stan() call, the stanmodel.command contains an array of Cmd fields that contain the actual run commands for each chain. These are executed in parallel if that is possible. The call to stan() might update other info in the StanModel, e.g. the names of diagnostics files.</p><p>The stan() call uses &#39;make&#39; to create (or update when needed) an executable with the given model.name, e.g. bernoulli in the above example. If no model AbstractString (or of zero length) is found, a message will be shown.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../INSTALLATION/">« Installation</a><a class="docs-footer-nextpage" href="../VERSIONS/">Versions »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 26 May 2021 22:07">Wednesday 26 May 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
